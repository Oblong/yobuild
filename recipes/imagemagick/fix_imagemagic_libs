# Run via YB_DEFAULT_BUILD_PRE_PACKAGE_HOOK.  yb_default_build must export DESTDIR and PREFIX.

# Work around apps that got used to bad library names generated by
# ImageMagick before 6.8.3-5 as described by
# http://www.imagemagick.org/discourse-server/viewtopic.php?f=3&t=22854
# by making the old, bad names synonyms for the new, good names.
# FIXME: purge the old bad names from affected source trees

for lib in $DESTDIR$PREFIX/lib/libMagick++-6*
do
    badoldname=`echo $lib | sed 's/++-6./++6-/'`
    goodfile=`basename $lib`
    ln -s $goodfile $badoldname
done
for lib in $DESTDIR$PREFIX/lib/libMagickCore-6*
do
    badoldname=`echo $lib | sed 's/Core-6./Core6-/'`
    goodfile=`basename $lib`
    ln -s $goodfile $badoldname
done
for lib in $DESTDIR$PREFIX/lib/libMagickWand-6*
do
    badoldname=`echo $lib | sed 's/Wand-6./Wand6-/'`
    goodfile=`basename $lib`
    ln -s $goodfile $badoldname
done

# Hey, fix the include files, too.  Otherwise #include <ImageMagick/Magick++.h> fails.
# (Dunno if this is a bug or a feature, but it didn't match Linux.)
ln -s ImageMagick-6 $DESTDIR$PREFIX/include/ImageMagick
